#!/usr/bin/env ruby
$:.unshift File.expand_path '../libs', File.dirname(__FILE__)
require 'ir_remote'

if ARGV.empty?
  STDERR.puts "#{$0} /dev/tty.usb-devicename"
  exit 1
end

ir = Ir::Remote.new ARGV.shift
ir.on :data do |data|
  puts data
end
last_ir_data = ""

puts "Ir::DATA => #{Ir::DATA.keys.inspect}"

loop do
  puts "read/write? [r/w]"
  line = STDIN.gets.strip
  if ["r", "read"].include? line.downcase
    puts "[READ]"
    ir.read do |data|
      last_ir_data = data
      p data
    end
  elsif ["w", "write"].include? line.downcase
    puts "[WRITE]"
    ir.write last_ir_data
  elsif Ir::DATA.has_key? line
    puts "[#{line}]"
    ir.write Ir::DATA[line]
  else
    puts "[#{line}] no data"
  end
end
