#!/usr/bin/env ruby
$:.unshift File.expand_path '../lib', File.dirname(__FILE__)
require 'arduino_ir_remote'

ir = ArduinoIrRemote.connect ARGV.shift
ir.temp_pin = 0
ir.on :read do |data|
  p data
end
ir.on :write do |data|
  p data
end

last_ir_data = ""

puts "IR DATA => #{ArduinoIrRemote::DATA.keys.inspect}"

Thread.new do
  loop do
    sleep 60
  end
end

loop do
  puts "read/write? [r/w]"
  line = STDIN.gets.strip
  puts "temperature: #{ir.temp_sensor}"
  if ["r", "read"].include? line.downcase
    puts "[READ]"
    ir.read do |data|
      last_ir_data = data
    end
  elsif ["w", "write"].include? line.downcase
    puts "[WRITE]"
    ir.write last_ir_data
  elsif ArduinoIrRemote::DATA.has_key? line
    puts "[#{line}]"
    ir.write ArduinoIrRemote::DATA[line]
  else
    puts "[#{line}] no data"
  end
  sleep 2
end
